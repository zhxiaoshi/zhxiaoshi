<div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://images.unsplash.com/photo-1611984676714-332dc8d9b954?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=2100&amp;q=80" alt="Missing values"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-03-17T13:03:11.000Z" title="2017/3/17 下午9:03:11">2017-03-17</time>发表</span><span class="level-item"><time dateTime="2021-06-20T17:06:06.982Z" title="2021/6/21 上午1:06:06">2021-06-21</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Study/">Study</a></span><span class="level-item">10 分钟读完 (大约1570个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Missing values</h1><div class="content"><link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>from <strong><a target="_blank" rel="noopener" href="http://stats.idre.ucla.edu/stata/faq/how-can-i-see-the-number-of-missing-values-and-patterns-of-missing-values-in-my-data-file/">http://stats.idre.ucla.edu/stata/faq/how-can-i-see-the-number-of-missing-values-and-patterns-of-missing-values-in-my-data-file/</a></strong></p>
 <span id="more"></span>

<p>Sometimes, a data set may have “holes” in it, that is, missing values. Some statistical procedures such as regression analysis will not work as well, or at all, on a data set with missing values.  The observations with missing values have to be deleted or the missing values have to be substituted in order for a statistical procedure to produce meaningful results. Most statistical programs (including SAS, SPSS, and Stata) will automatically remove such cases from any analysis you run (without deleting the cases from the dataset). This is why the “n” often varies from analysis to analysis, even if the dataset is the same. Different variables have different amounts of missing data and hence, changing the variables in a model changes the number of cases with complete data on all the variables in the model. Because the software drops cases with missing values for us, it is very easy to “forget” about missing data entirely. However, the presence of missing data can influence our results, especially when a dataset or even a single variable, has a high percentage of values missing. Thus it is always a good idea to check a dataset for missing data, and to think about how the missing data may influence our analyses. This page shows a few methods of looking at missing values in a dataset, this information can be used to make better informed decisions about how to handle the missing values.</p>
<!--more-->

<p>Before we begin, we need some data with missing values, the code below inputs a small dataset into Stata, and then displays that data. In a small dataset, like the one below, it is very easy to look at the raw data and see where values are missing. However, when datasets are large, we need a more systematic way to examine our dataset for missing values. Below we show you some ways to do that, using the data below as an example.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">clear</span></span><br><span class="line"><span class="keyword">input</span>    landval  improval  totval  salepric saltoapr</span><br><span class="line">30000     64831     94831    118500   1.25</span><br><span class="line">30000     50765     80765     93900    .</span><br><span class="line">46651     18573     65224         .   1.16</span><br><span class="line">45990     91402         .    184000   1.34</span><br><span class="line">42394         .     40575    168000   1.43</span><br><span class="line">    .      3351     51102    169000   1.12</span><br><span class="line">63596      2182     65778         .   1.26</span><br><span class="line">56658     53806     10464    255000   1.21</span><br><span class="line">51428     72451         .         .   1.18</span><br><span class="line">93200         .      4321    422000   1.04</span><br><span class="line">76125     78172     54297    290000   1.14</span><br><span class="line">    .     61934     16294    237000   1.10</span><br><span class="line">65376     34458         .    286500   1.43</span><br><span class="line">42400         .     57446         .    .</span><br><span class="line">40800     92606     33406    168000   1.26</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"><span class="keyword">list</span></span><br><span class="line"></span><br><span class="line">     +---------------------------------------------------+</span><br><span class="line">     | landval   improval   totval   salepric   saltoapr |</span><br><span class="line">     |---------------------------------------------------|</span><br><span class="line">  1. |   30000      64831    94831     118500       1.25 |</span><br><span class="line">  2. |   30000      50765    80765      93900          . |</span><br><span class="line">  3. |   46651      18573    65224          .       1.16 |</span><br><span class="line">  4. |   45990      91402        .     184000       1.34 |</span><br><span class="line">  5. |   42394          .    40575     168000       1.43 |</span><br><span class="line">     |---------------------------------------------------|</span><br><span class="line">  6. |       .       3351    51102     169000       1.12 |</span><br><span class="line">  7. |   63596       2182    65778          .       1.26 |</span><br><span class="line">  8. |   56658      53806    10464     255000       1.21 |</span><br><span class="line">  9. |   51428      72451        .          .       1.18 |</span><br><span class="line"> 10. |   93200          .     4321     422000       1.04 |</span><br><span class="line">     |---------------------------------------------------|</span><br><span class="line"> 11. |   76125      78172    54297     290000       1.14 |</span><br><span class="line"> 12. |       .      61934    16294     237000        1.1 |</span><br><span class="line"> 13. |   65376      34458        .     286500       1.43 |</span><br><span class="line"> 14. |   42400          .    57446          .          . |</span><br><span class="line"> 15. |   40800      92606    33406     168000       1.26 |</span><br><span class="line">     +---------------------------------------------------+	</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="1-Number-of-missing-values-vs-number-of-non-missing-values"><a href="#1-Number-of-missing-values-vs-number-of-non-missing-values" class="headerlink" title="1. Number of missing values vs. number of  non missing values"></a>1. Number of missing values vs. number of  non missing values</h2><p>The first thing we are going to do is determine which variables have a lot of missing values. We have created a small Stata program called <strong>mdesc</strong> that counts the number of missing values in both numeric and character variables. You can download <strong>mdesc</strong> from within Stata by typing <strong>search mdesc</strong> (see<a target="_blank" rel="noopener" href="http://stats.idre.ucla.edu/stata/faq/search-faq/"> How can I use the search command to search for programs and get additional help?</a> for more information about using <strong>finidit</strong>).</p>
<p>Then you can run <strong>mdesc</strong> for one or more variables as illustrated below.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mdesc</span><br><span class="line"></span><br><span class="line">     Variable      Missing      <span class="keyword">Total</span>     Missing/<span class="keyword">Total</span></span><br><span class="line">    ------------------------------------------------------------</span><br><span class="line">     landval           2          15        .133333</span><br><span class="line">    improval           3          15             .2</span><br><span class="line">      totval           3          15             .2</span><br><span class="line">    salepric           4          15        .266667</span><br><span class="line">    saltoapr           2          15        .133333</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Now we know the number of missing values in each variable. For instance, variable <strong>salepric</strong> has four missing values and <strong>saltoapr</strong> has two missing values.</p>
<h2 id="2-Obtaining-the-number-of-missing-values-per-observation"><a href="#2-Obtaining-the-number-of-missing-values-per-observation" class="headerlink" title="2. Obtaining the number of missing values per observation"></a>2. Obtaining the number of missing values per observation</h2><p>We can also look at the distribution of missing values across observations. The code below creates a variable called <strong>nmis</strong> that gives the number of missing values for each observation. The function <strong>rmiss2()</strong> used here is an extension to the egen function <strong>rmiss()</strong>. It counts the number of missing values in the varlist.<strong>rmiss2()</strong> accepts both string and numeric variables. (Stata’s <strong>rmiss()</strong> only accepts numeric variables.) You can download **rmiss2() **over the internet from within Stata by typing <strong>search rmiss2</strong> (see<a target="_blank" rel="noopener" href="http://stats.idre.ucla.edu/stata/faq/search-faq/"> How can I use the search command to search for programs and get additional help?</a> for more information about using <strong>search</strong>).</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">egen</span> nmis=rmiss2(landval improval totval salepric saltoapr)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Below we tabulate the variable we just created. Looking at the frequency table we know that there are four observations with no missing values, nine observations with one missing values, one observation with two missing values and one observation with three missing values.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">tab</span> nmis</span><br><span class="line"></span><br><span class="line">       nmis |      Freq.     Percent        Cum.</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">          0 |          4       26.67       26.67</span><br><span class="line">          1 |          9       60.00       86.67</span><br><span class="line">          2 |          1        6.67       93.33</span><br><span class="line">          3 |          1        6.67      100.00</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">      <span class="keyword">Total</span> |         15      100.00  </span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="3-Patterns-of-missing-values"><a href="#3-Patterns-of-missing-values" class="headerlink" title="3. Patterns of missing values"></a>3. Patterns of missing values</h2><p>We can also look at the patterns of missing values. You can download **mvpatterns **over the internet from within Stata by typing <strong>search mvpatterns</strong> (see<a target="_blank" rel="noopener" href="http://stats.idre.ucla.edu/stata/faq/search-faq/"> How can I use the search command to search for programs and get additional help?</a> for more information about using <strong>search</strong>). The command <strong>mvpatterns</strong> produces output for all variables in the dataset, for missing data patterns across a subset of variables, a variable list can be included, for example, <strong>mvpatterns landval improval totval</strong>.</p>
<p>The output produced by <strong>mvpatterns</strong> is shown below. The first table lists the variables, their storage type (type), the number of observations (obs), the number of missing values (mv), and the variable label if the variables has one. The second table contains the information on the pattern of missing values. The first block of columns in the output shows the patterns of missing data. Within the block, each variable is represented by a column, a “+” indicates that values of that variable are present in a given missing data pattern, a “.” indicates that they are missing. The columns follow the same order as the variable list in the first table, so that the first column in the output below represents <strong>landval</strong>, the second <strong>improval</strong>, and so on. The missing data patterns are listed in descending frequency, here the most common missing data pattern is complete data (“+++++”). The table also shows the number of missing values in that pattern (_mv), and the number of cases with that missing data pattern (_freq). Based on the information in the second table we know that there are four observations with no missing values, two cases missing on just the variable <strong>salepric</strong>, and one observation with missing values on <strong>improval</strong>, <strong>salepric</strong> and <strong>saltoapr</strong>.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mvpatterns</span><br><span class="line">  </span><br><span class="line">Variable     | <span class="keyword">type</span>     obs   mv   variable <span class="keyword">label</span></span><br><span class="line">-------------+-----------------------------------</span><br><span class="line">landval      | float     13    2   </span><br><span class="line">improval     | float     12    3   </span><br><span class="line">totval       | float     12    3   </span><br><span class="line">salepric     | float     11    4   </span><br><span class="line">saltoapr     | float     13    2   </span><br><span class="line">-------------------------------------------------</span><br><span class="line"></span><br><span class="line">Patterns of missing values</span><br><span class="line"></span><br><span class="line">  +------------------------+</span><br><span class="line">  | _pattern   _mv   _freq |</span><br><span class="line">  |------------------------|</span><br><span class="line">  |    +++++     0       4 |</span><br><span class="line">  |    +++.+     1       2 |</span><br><span class="line">  |    ++.++     1       2 |</span><br><span class="line">  |    +.+++     1       2 |</span><br><span class="line">  |    .++++     1       2 |</span><br><span class="line">  |------------------------|</span><br><span class="line">  |    ++++.     1       1 |</span><br><span class="line">  |    ++..+     2       1 |</span><br><span class="line">  |    +.+..     3       1 |</span><br><span class="line">  +------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="4-When-all-the-variables-of-interest-are-numeric"><a href="#4-When-all-the-variables-of-interest-are-numeric" class="headerlink" title="4. When all the variables of interest are numeric"></a>4. When all the variables of interest are numeric</h2><p>The examples above all work regardless of whether the variables of interest (i.e. the variables whose missing data patterns you want to examine) are numeric or string. When all of the variables you wish to check for missing values are numeric we can use a program called <strong>misschk</strong> to simplify the steps of examining the missing data in our dataset. (Note: numeric variables include those with value labels that are strings, as long as the actual values of the variables are stored as numbers.) You can download <strong>misschk</strong> from within Stata by typing **search misschk **(see <a target="_blank" rel="noopener" href="http://stats.idre.ucla.edu/stata/faq/search-faq/">How can I use the search command to search for programs and get additional help?</a> for more information about using <strong>search</strong>).</p>
<p>Below is the command for <strong>misschk</strong>. We have listed all five of the variables in our dataset in the variable list after the <strong>misschk</strong> command. However, we could have just left the list of variables blank (i.e. used only <strong>misschk , gen(miss)</strong> instead), if we had, <strong>misschk</strong> would have run using all the variables in our dataset. The variable list is only necessary if we want to run <strong>misschk</strong> on only some of the variables in our dataset. The <strong>gen(miss)</strong> option tells <strong>misschk</strong> that we want it to create two new variables, both of which start with “miss”. These two variables will be named <strong>misspattern</strong> and <strong>missnumber</strong>. The variable <strong>misspattern</strong> indicates which of the missing data patterns each case follows. The variable <strong>missnumber</strong> indicates the number of missing values for each case.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">misschk landval improval totval salepric saltoapr, <span class="keyword">gen</span>(miss)</span><br></pre></td></tr></table></figure>
</blockquote>
<p>The output for <strong>misschk</strong> consists of three tables. The first table lists the number of missing values, as well as percent missing for each variable, this is similar to the table produced by <strong>mdesc</strong> in part 1 above. This table also contains a column labeled “#” which assigns each variable a number that is used to identify the variable later on in the output. The second table shows the distribution of missing values. The pattern of missingness is described using the variable numbers from the first table, and underscores (“_”). The numbers indicate which variables are missing in that pattern, the underscores represent non-missing observations. For example, from the second table we see that two cases have missing values on variable 1 (<strong>landval</strong>), but complete data on all other variables, and that one case is missing data on variables 2, 4, and 5. The bottom row shows that four cases are not missing any values at all (all underscores). This table shows the same information generated in part three above, but in a slightly different format. The missing data pattern for each case is described in the variable <strong>misspattern</strong>. Finally, the third table shows the distribution of the number of missing values per case. This is the same information discussed above in part 2. The number of variables each case is missing is also contained in the variable <strong>missnumber</strong>.</p>
<blockquote>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Variables examined <span class="keyword">for</span> missing values</span><br><span class="line"></span><br><span class="line">   #  Variable        # Missing   % Missing</span><br><span class="line">--------------------------------------------</span><br><span class="line">   1  landval               2        13.3</span><br><span class="line">   2  improval              3        20.0</span><br><span class="line">   3  totval                3        20.0</span><br><span class="line">   4  salepric              4        26.7</span><br><span class="line">   5  saltoapr              2        13.3</span><br><span class="line"></span><br><span class="line">Missing <span class="keyword">for</span> |</span><br><span class="line">      <span class="keyword">which</span> |</span><br><span class="line"> variables? |      Freq.     Percent        Cum.</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">      1____ |          2       13.33       13.33</span><br><span class="line">      _2_45 |          1        6.67       20.00</span><br><span class="line">      _2___ |          2       13.33       33.33</span><br><span class="line">      __34_ |          1        6.67       40.00</span><br><span class="line">      __3__ |          2       13.33       53.33</span><br><span class="line">      ___4_ |          2       13.33       66.67</span><br><span class="line">      ____5 |          1        6.67       73.33</span><br><span class="line">      _____ |          4       26.67      100.00</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">      <span class="keyword">Total</span> |         15      100.00</span><br><span class="line"></span><br><span class="line">Missing <span class="keyword">for</span> |</span><br><span class="line">   how many |</span><br><span class="line"> variables? |      Freq.     Percent        Cum.</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">          0 |          4       26.67       26.67</span><br><span class="line">          1 |          9       60.00       86.67</span><br><span class="line">          2 |          1        6.67       93.33</span><br><span class="line">          3 |          1        6.67      100.00</span><br><span class="line">------------+-----------------------------------</span><br><span class="line">      <span class="keyword">Total</span> |         15      100.00</span><br></pre></td></tr></table></figure>
</blockquote>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Stata/">Stata</a></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><div class="social-share"></div><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/img/qr-alipay.png" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/img/qr-wechat.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/posts/ff9a.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item">New page</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/posts/87c4.html"><span class="level-item">《从0到1—开启商业与未来的秘密》读书笔记</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="content" id="valine-thread"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script><script>new Valine({
            el: '#valine-thread' ,
            appId: "8zBTgTjmVw4qEoSSiaN1MCdy-MdYXbMMI",
            appKey: "phllF76VFRUx8cQwsHGmaWFu",
            placeholder: "请留下邮箱以便回复您时，您可以收到邮件通知。",
            avatar: "retro",
            
            meta: ["nick","mail","link"],
            pageSize: 10,
            lang: "zh-CN",
            
            highlight: true,
            
            
            
            
            
            requiredFields: [],
        });</script></div></div>